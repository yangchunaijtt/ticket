{"version":3,"sources":["webpack:///src/components/pages/pay.vue","webpack:///./src/components/pages/pay.vue?86d6","webpack:///./src/components/pages/pay.vue"],"names":["pay","name","components","mt-header","mint_ui_common","mt-button","data","eid","canpay","remain_time","price","roomname","startDate","createtime","timid","where","openid","userphone","secret","userid","sign","guestIp","orderno","created","this","$cookie","get","mounted","methods","countdown","nowDate","Date","nowparse","parse","remaintime_parse","clearInterval","Object","window","location","href","remain_min","parseInt","remain_sec","console","log","Topay","returnurl","hostname","host","BC","click","title","amount","out_trade_no","return_url","optional","contactId","contactSource","orderId","analysis","ip","wxJsapiFinish","res","err_msg","beforeRouteLeave","to","from","next","vm","beforeRouteEnter","open","query","AffiliateConfirmationId","OrderId","paysignurl","t_title","t_orderno","p_axios","all","params","then","spread","sig","close","setInterval","pages_pay","render","_vm","_h","$createElement","_c","_self","staticClass","attrs","fixed","_v","_s","type","size","on","_e","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/0.a313b4324c7be2ef446e.js","sourcesContent":["<template>\r\n  <div class=\"pay\">\r\n    <mt-header fixed title=\"支付订单\"></mt-header>\r\n    <div class=\"paycontent\">\r\n      <div class=\"paynum\">\r\n        <div class=\"pay-time\">\r\n          支付剩余时间 {{remain_time}}\r\n        </div>\r\n        <div class=\"pay-price\">\r\n          <span>￥</span>\r\n          <span>{{price}}</span>\r\n        </div>\r\n        <div class=\"bedtitle\">\r\n          <span>{{roomname}}</span>\r\n          <span>{{startDate}}</span>\r\n          <span>入住</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"paybutton\" v-if=\"canpay\">\r\n      <mt-button type=\"primary\" size=\"large\" @click=\"Topay\">支付￥{{price}}</mt-button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  Swipe,\r\n  SwipeItem,\r\n  Popup,\r\n  Indicator,\r\n  Header,\r\n  Button,\r\n  Toast\r\n} from \"mint-ui\";\r\nimport axios from \"@/assets/js/p_axios.js\";\r\n\r\nexport default {\r\n  name: \"pay\",\r\n  components: {\r\n    \"mt-header\": Header,\r\n    \"mt-button\": Button\r\n  },\r\n  data() {\r\n    return {\r\n      eid: \"\",\r\n      canpay: true,\r\n      remain_time: \"00:00\",\r\n      price: 0,\r\n      roomname: \"\",\r\n      startDate: \"\",\r\n      createtime: \"d\",\r\n      timid: 0,\r\n      //支付相关\r\n      where: \"\",\r\n      openid: \"\",\r\n      userphone: \"\",\r\n      secret: \"\",\r\n      userid: \"\",\r\n      sign: \"\",\r\n      guestIp: \"\",\r\n      orderno: \"\"\r\n    };\r\n  },\r\n  created() {\r\n    this.where = this.$cookie.get(\"WHERE\");\r\n    this.openid = this.$cookie.get(\"WXOPID\");\r\n    this.userphone = this.$cookie.get(\"gdmobileuserphone\");\r\n    this.secret = this.$cookie.get(\"usersecret\");\r\n    this.userid = this.$cookie.get(\"USERIDGDLY\");\r\n  },\r\n  mounted() {},\r\n  methods: {\r\n    countdown() {\r\n      //倒计时，\r\n\r\n      let nowDate = new Date();\r\n\r\n      let nowparse = Date.parse(nowDate);\r\n      let remaintime_parse = (this.createtime - nowparse) / 1000;\r\n      if (remaintime_parse > 0) {\r\n        let remain_min = parseInt(remaintime_parse / 60);\r\n        let remain_sec = parseInt(remaintime_parse % 60);\r\n        // console.log(\"剩下的小时\", remain_min);\r\n        // console.log(\"剩下的分钟\", remain_sec);\r\n        console.log(remain_min + \":\" + remain_sec);\r\n        if (remain_min == 0 && remain_sec == 0) {\r\n          clearInterval(this.timid);\r\n        }\r\n        // let second = Math.floor((newTime - oldTime) / 1000);//未来时间距离现在的秒数\r\n        // let day = Math.floor(second / 86400);//整数部分代表的是天；一天有24*60*60=86400\r\n        remain_min = remain_min >= 10 ? remain_min : \"0\" + remain_min;\r\n        remain_sec = remain_sec >= 10 ? remain_sec : \"0\" + remain_sec;\r\n        this.remain_time = remain_min + \":\" + remain_sec;\r\n      } else {\r\n        clearInterval(this.timid);\r\n        Toast(\"订单已经超时，请重新下单\");\r\n        this.canpay = false;\r\n        window.location.href='../hotel/';\r\n        // this.$router.go(\"/\");\r\n        return \"\";\r\n      }\r\n\r\n      // ddd();\r\n    },\r\n    Topay() {\r\n      let gd_reutrnurl =\r\n        \"http://m.czgdly.com/transportation/pay/html/hotelpaysuccess.html\";\r\n      let wd_returnurl =\r\n        \"http://m.wandaly.net/transportation/pay/html/hotelpaysuccess.html\";\r\n      let returnurl = \"\";\r\n      if (location.hostname == \"m.wandaly.net\") {\r\n        returnurl = wd_returnurl;\r\n      } else {\r\n        returnurl = gd_reutrnurl;\r\n      }\r\n      returnurl=`http://${window.location.host}/transportation/pay/html/hotelpaysuccess.html`\r\n      BC.click({\r\n        title: \"酒店预定\",\r\n        amount:  parseInt(this.price * 100),\r\n        out_trade_no: this.orderno,\r\n        sign: this.sign,\r\n        // debug:true,\r\n        return_url:returnurl, //http://m.czgdly.com/airplane/FlightTickets/#/list\r\n        optional: {\r\n          contactId: this.$cookie.get(\"USERIDGDLY\"),\r\n          contactSource: this.where,\r\n          orderId: this.eid\r\n            // mainOrderNo: this.mainorderno\r\n        },\r\n        analysis: {\r\n          ip: this.guestIp\r\n        },\r\n        openid: this.openid\r\n      },{\r\n          wxJsapiFinish: function(res) {\r\n            //jsapi接口调用完成后\r\n            // alert(JSON.stringify(res));\r\n              if(res.err_msg == \"get_brand_wcpay_request:ok\" ) {\r\n                // window.href=\"\"\r\n                window.location.href=returnurl\r\n              } \r\n          }\r\n        });\r\n    }\r\n  },\r\n  beforeRouteLeave: (to, from, next) => {\r\n    console.log(\"离开的时候\");\r\n    next(vm => {\r\n      clearInterval(vm.timid);\r\n    });\r\n  },\r\n  beforeRouteEnter: (to, from, next) => {\r\n    Indicator.open();\r\n    console.log(\"支付页面\", to.query);\r\n    // let orderinfo = JSON.parse(to.query.orderdata);\r\n    let title = \"酒店预定\";\r\n    let orderno = to.query.AffiliateConfirmationId; //自己订单号码\r\n    let eid = to.query.OrderId;\r\n    let amount = to.query.price ; //价格\r\n    // let gd_paysignurl =\r\n    //   \"http://m.czgdly.com/transportation/airplane/Beecloud/getsign.asp\"; //光大的\r\n    let gd_paysignurl =\r\n      \"http://m.czgdly.com/transportation/airplane/Beecloud/getsign.asp\"; //光大的\r\n    let wd_paysignurl =\r\n      \"http://m.czgdly.com/transportation/gdtrain/Beecloud/getsign.asp\"; //万达的\r\n    let paysignurl = \"\";\r\n    if (location.hostname == \"m.wandaly.net\") {\r\n      paysignurl = wd_paysignurl;\r\n    } else {\r\n      paysignurl = gd_paysignurl;\r\n    }\r\n    let getIp = function() {\r\n      return axios.get(\r\n        \"http://m.czgdly.com/transportation/airplane/beecloud/getCurrentIp.asp\"\r\n      );\r\n    };\r\n    let getSign = function(t_title, t_orderno, t_price) {\r\n      return axios.get(paysignurl, {\r\n        params: {\r\n          title: t_title,\r\n          amount: parseInt(amount*100), //amount\r\n          orderno: t_orderno\r\n        }\r\n      });\r\n    };\r\n    axios.all([getIp(), getSign(title, orderno, amount)]).then(\r\n      axios.spread(function(ip, sig) {\r\n        console.log(\"支付页面的\");\r\n        console.log(\"ip\", ip.data);\r\n        console.log(\"sign\", sig);\r\n        Indicator.close();\r\n        next(vm => {\r\n          Indicator.close();\r\n          vm.eid = eid;\r\n          vm.orderno = orderno;\r\n          vm.sign = sig.data;\r\n          vm.guestIp = ip.data;\r\n          vm.startDate = to.query.startDate;\r\n          vm.price = to.query.price;\r\n          vm.roomname = to.query.roomname;\r\n          vm.createtime = parseInt(to.query.createtime);\r\n          console.log(\"时间\",vm.createtime);\r\n          vm.timid = setInterval(() => {\r\n            vm.countdown();\r\n          }, 1000);\r\n        });\r\n      })\r\n    );\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.paycontent {\r\n  padding-top:50px;\r\n}\r\n.paynum {\r\n  padding: 10px 0;\r\n  background-color: #fff;\r\n  color: #8a8a8a;\r\n  font-size: 12px;\r\n}\r\n.pay-price {\r\n  font-size: 30px;\r\n  color: #000;\r\n}\r\n.paybutton {\r\n  padding: 0 20px;\r\n  margin-top: 20px;\r\n}\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/components/pages/pay.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"pay\"},[_c('mt-header',{attrs:{\"fixed\":\"\",\"title\":\"支付订单\"}}),_vm._v(\" \"),_c('div',{staticClass:\"paycontent\"},[_c('div',{staticClass:\"paynum\"},[_c('div',{staticClass:\"pay-time\"},[_vm._v(\"\\n        支付剩余时间 \"+_vm._s(_vm.remain_time)+\"\\n      \")]),_vm._v(\" \"),_c('div',{staticClass:\"pay-price\"},[_c('span',[_vm._v(\"￥\")]),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.price))])]),_vm._v(\" \"),_c('div',{staticClass:\"bedtitle\"},[_c('span',[_vm._v(_vm._s(_vm.roomname))]),_vm._v(\" \"),_c('span',[_vm._v(_vm._s(_vm.startDate))]),_vm._v(\" \"),_c('span',[_vm._v(\"入住\")])])])]),_vm._v(\" \"),(_vm.canpay)?_c('div',{staticClass:\"paybutton\"},[_c('mt-button',{attrs:{\"type\":\"primary\",\"size\":\"large\"},on:{\"click\":_vm.Topay}},[_vm._v(\"支付￥\"+_vm._s(_vm.price))])],1):_vm._e()],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7a57fc0e\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/pages/pay.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7a57fc0e\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./pay.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./pay.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./pay.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7a57fc0e\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./pay.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/pages/pay.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}